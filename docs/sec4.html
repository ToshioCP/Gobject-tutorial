  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="generator" content="pandoc" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>GObject tutorial</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      pre{overflow: visible;}
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::after
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          color: #aaaaaa;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span.al { color: #ff0000; font-weight: bold; } /* Alert */
      code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
      code span.at { color: #7d9029; } /* Attribute */
      code span.bn { color: #40a070; } /* BaseN */
      code span.bu { } /* BuiltIn */
      code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #4070a0; } /* Char */
      code span.cn { color: #880000; } /* Constant */
      code span.co { color: #60a0b0; font-style: italic; } /* Comment */
      code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
      code span.do { color: #ba2121; font-style: italic; } /* Documentation */
      code span.dt { color: #902000; } /* DataType */
      code span.dv { color: #40a070; } /* DecVal */
      code span.er { color: #ff0000; font-weight: bold; } /* Error */
      code span.ex { } /* Extension */
      code span.fl { color: #40a070; } /* Float */
      code span.fu { color: #06287e; } /* Function */
      code span.im { } /* Import */
      code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
      code span.kw { color: #007020; font-weight: bold; } /* Keyword */
      code span.op { color: #666666; } /* Operator */
      code span.ot { color: #007020; } /* Other */
      code span.pp { color: #bc7a00; } /* Preprocessor */
      code span.sc { color: #4070a0; } /* SpecialChar */
      code span.ss { color: #bb6688; } /* SpecialString */
      code span.st { color: #4070a0; } /* String */
      code span.va { color: #19177c; } /* Variable */
      code span.vs { color: #4070a0; } /* VerbatimString */
      code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
      div.sourceCode { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      pre:not(.sourceCode) { margin: 10px; padding: 16px 10px 8px 10px; border: 2px solid silver; background-color: ghostwhite; overflow-x:scroll}
      table {margin-left: auto; margin-right: auto; border-collapse: collapse; border: 1px solid;}
      th {padding: 2px 6px; border: 1px solid; background-color: ghostwhite;}
      td {padding: 2px 6px; border: 1px solid;}
      img {display: block; margin-left: auto; margin-right: auto;}
      figcaption {text-align: center;}
    </style>
  </head>
  <body style="padding-top: 70px;">
    <div class="container">
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
      <div class="container-fluid">
        <span class="navbar-brand">Gtk4 tutorial</span>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
<a class="nav-link" href="index.html">Home</a>
</li>

            <li class="nav-item">
<a class="nav-link" href="sec3.html">Prev: section3</a>
</li>

            <li class="nav-item">
<a class="nav-link" href="sec5.html">Next: section5</a>
</li>

          </ul>
        </div>
      </div>
    </nav>
<h1 id="signals">Signals</h1>
<h2 id="signals-1">Signals</h2>
<p>Signals provide a means of communication between objects. Signals are
emitted when something happens or completes.</p>
<p>The steps to program a signal is shown below.</p>
<ol type="1">
<li>Register a signal. A signal belongs to an object, so the
registration is done in the class initialization function of the
object.</li>
<li>Write a signal handler. A signal handler is a function that is
invoked when the signal is emitted.</li>
<li>Connect the signal and handler. Signals are connected to handlers
with <code>g_connect_signal</code> or its family functions.</li>
<li>Emit the signal.</li>
</ol>
<p>Step one and Four are done on the object to which the signal belongs.
Step three is usually done outside the object.</p>
<p>The process of signals is complicated and it takes long to explain
all the features. The contents of this section is limited to the minimum
things to write a simple signal and not necessarily accurate. If you
need an accurate information, refer to GObject API reference. There are
three parts which describe signals.</p>
<ul>
<li><a href="https://docs.gtk.org/gobject/concepts.html#signals">Type
System Concepts, signals</a></li>
<li><a
href="https://developer-old.gnome.org/gobject/stable/gobject-Signals.html">Old
GObject Reference Manual, Signals</a></li>
<li><a
href="https://docs.gtk.org/gobject/tutorial.html#how-to-create-and-use-signals">GObject
Tutorial, How to create and use signals</a></li>
</ul>
<h2 id="signal-registration">Signal registration</h2>
<p>An example in this section is a signal emitted when division-by-zero
happens. First, we need to determine the name of the signal. Signal name
consists of letters, digits, dash (<code>-</code>) and underscore
(<code>_</code>). The first character of the name must be a letter. So,
a string “div-by-zero”is appropriate for the signal name.</p>
<p>There are four functions to register a signal. We will use
<code>g_signal_new</code> for “div-by-zero” signal.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>guint</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>g_signal_new <span class="op">(</span><span class="dt">const</span> gchar <span class="op">*</span>signal_name<span class="op">,</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>              GType itype<span class="op">,</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>              GSignalFlags signal_flags<span class="op">,</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>              guint class_offset<span class="op">,</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>              GSignalAccumulator accumulator<span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>              gpointer accu_data<span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              GSignalCMarshaller c_marshaller<span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              GType return_type<span class="op">,</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              guint n_params<span class="op">,</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>              <span class="op">...);</span></span></code></pre></div>
<p>It needs a lot to explain each parameter. At present I just show you
<code>g_signal_new</code> function call extracted from
<code>tdouble.c</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>t_double_signal <span class="op">=</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>g_signal_new <span class="op">(</span><span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>              G_TYPE_FROM_CLASS <span class="op">(</span>class<span class="op">),</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>              G_SIGNAL_RUN_LAST <span class="op">|</span> G_SIGNAL_NO_RECURSE <span class="op">|</span> G_SIGNAL_NO_HOOKS<span class="op">,</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span> <span class="co">/* class offset.Subclass cannot override the class handler (default handler). */</span><span class="op">,</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>              NULL <span class="co">/* accumulator */</span><span class="op">,</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>              NULL <span class="co">/* accumulator data */</span><span class="op">,</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>              NULL <span class="co">/* C marshaller. g_cclosure_marshal_generic() will be used */</span><span class="op">,</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>              G_TYPE_NONE <span class="co">/* return_type */</span><span class="op">,</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>              <span class="dv">0</span>     <span class="co">/* n_params */</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>              <span class="op">);</span></span></code></pre></div>
<ul>
<li><code>t_double_signal</code> is a static guint variable. Guint type
is the same as unsigned int. It is set the signal id.</li>
<li>The second parameter is the type (GType) of the object the signal
belongs to. <code>G_TYPE_FROM_CLASS (class)</code> returns the type
corresponds to the class (<code>class</code> is a pointer to the class
of the object).</li>
<li>The third parameter is a signal flag. Lots of pages are necessary to
explain this flag. So, I want leave them out now. The argument above can
be used in many cases. The definition is described in the <a
href="https://docs.gtk.org/gobject/flags.SignalFlags.html">GObject API
Reference, SignalFlags</a>.</li>
<li>The return type is G_TYPE_NONE which means no value is returned by
the signal handler.</li>
<li><code>n_params</code> is a number of parameters. This signal doesn’t
have parameters, so it is zero.</li>
</ul>
<p>This function call is in the class initialization function.</p>
<p>You can use other functions such as <code>g_signal_newv</code>. See
<a href="https://docs.gtk.org/gobject/func.signal_newv.html">GObject API
Reference</a> for details.</p>
<h2 id="signal-handler">Signal handler</h2>
<p>Signal handler is a function that is called when the signal is
emitted. The handler has two parameters.</p>
<ul>
<li>The instance to which the signal belongs</li>
<li>A pointer to a user data which is given in the signal
connection.</li>
</ul>
<p>The “div-by-zero” signal doesn’t need user data.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> div_by_zero_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">...</span> <span class="op">...};</span></span></code></pre></div>
<p>Or, you can leave out the second parameter.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> div_by_zero_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">...</span> <span class="op">...};</span></span></code></pre></div>
<p>If a signal has parameters, the parameters are between the instance
and user data. For example, the handler of “response” signal on
GtkDialog is:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> user_function <span class="op">(</span>GtkDialog <span class="op">*</span>dialog<span class="op">,</span> <span class="dt">int</span> response_id<span class="op">,</span> gpointer user_data<span class="op">);</span></span></code></pre></div>
<p><code>resoponse_id</code> is the parameter of the signal. The
“response” signal is emitted when a user clicks on a button like “OK” or
“Cancel”. The argument of <code>response_id</code> is a value that shows
what button has been clicked.</p>
<p>The handler of “div-by-zero” signal just shows an error message.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>div_by_zero_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error: division by zero.</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="signal-connection">Signal connection</h2>
<p>A signal and a handler are connected with the function
<code>g_signal_connect</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>g_signal_connect <span class="op">(</span>d1<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>div_by_zero_cb<span class="op">),</span> NULL<span class="op">);</span></span></code></pre></div>
<ul>
<li><code>d1</code> is an instance the signal belongs.</li>
<li>The second argument is the signal name.</li>
<li>The third argument is the signal handler. It must be casted by
<code>G_CALLBACK</code>.</li>
<li>The last argument is an user data. The signal doesn’t need a user
data, so NULL is assigned.</li>
</ul>
<h2 id="signal-emission">Signal emission</h2>
<p>Signals are emitted on the object. The following is a part of
<code>tdouble.c</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>TDouble <span class="op">*</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>t_double_div <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">,</span> TDouble <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="op">...</span> <span class="op">...</span> <span class="op">...</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">((!</span> t_double_get_value <span class="op">(</span>other<span class="op">,</span> <span class="op">&amp;</span>value<span class="op">)))</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>value <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    g_signal_emit <span class="op">(</span>self<span class="op">,</span> t_double_signal<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> t_double_new <span class="op">(</span>self<span class="op">-&gt;</span>value <span class="op">/</span> value<span class="op">);</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If the divisor is zero, the signal is emitted.
<code>g_signal_emit</code> has three parameters.</p>
<ul>
<li>The first parameter is the instance that emits the signal.</li>
<li>The second parameter is the signal id. Signal id has been set with
<code>g_signal_new</code> function.</li>
<li>The third parameter is detail. “dev-by-zero” signal doesn’t have a
detail, so the argument is zero. Detail isn’t explained in this section.
If you want to know details, refer to <a
href="https://docs.gtk.org/gobject/concepts.html#the-detail-argument">GObject
API Reference, Signal Detail</a>.</li>
</ul>
<p>If a signal has parameters, they are fourth and subsequent
arguments.</p>
<h2 id="example-code">Example code</h2>
<p>A sample program is in src/tdouble3.</p>
<p>tdouble.c</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="dt">static</span> guint t_double_signal<span class="op">;</span></span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="kw">struct</span> _TDouble <span class="op">{</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>  GObject parent<span class="op">;</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="op">};</span></span>
<span id="cb9-9"><a href="#cb9-9"></a></span>
<span id="cb9-10"><a href="#cb9-10"></a>G_DEFINE_TYPE <span class="op">(</span>TDouble<span class="op">,</span> t_double<span class="op">,</span> G_TYPE_OBJECT<span class="op">)</span></span>
<span id="cb9-11"><a href="#cb9-11"></a></span>
<span id="cb9-12"><a href="#cb9-12"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb9-13"><a href="#cb9-13"></a>t_double_class_init <span class="op">(</span>TDoubleClass <span class="op">*</span>class<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>  t_double_signal <span class="op">=</span> g_signal_new <span class="op">(</span><span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span></span>
<span id="cb9-15"><a href="#cb9-15"></a>                                 G_TYPE_FROM_CLASS <span class="op">(</span>class<span class="op">),</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>                                 G_SIGNAL_RUN_LAST <span class="op">|</span> G_SIGNAL_NO_RECURSE <span class="op">|</span> G_SIGNAL_NO_HOOKS<span class="op">,</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>                                 <span class="dv">0</span> <span class="co">/* class offset.Subclass cannot override the class handler (default handler). */</span><span class="op">,</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>                                 NULL <span class="co">/* accumulator */</span><span class="op">,</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>                                 NULL <span class="co">/* accumulator data */</span><span class="op">,</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>                                 NULL <span class="co">/* C marshaller. g_cclosure_marshal_generic() will be used */</span><span class="op">,</span></span>
<span id="cb9-21"><a href="#cb9-21"></a>                                 G_TYPE_NONE <span class="co">/* return_type */</span><span class="op">,</span></span>
<span id="cb9-22"><a href="#cb9-22"></a>                                 <span class="dv">0</span>     <span class="co">/* n_params */</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>                                 <span class="op">);</span></span>
<span id="cb9-24"><a href="#cb9-24"></a><span class="op">}</span></span>
<span id="cb9-25"><a href="#cb9-25"></a></span>
<span id="cb9-26"><a href="#cb9-26"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>t_double_init <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-28"><a href="#cb9-28"></a><span class="op">}</span></span>
<span id="cb9-29"><a href="#cb9-29"></a></span>
<span id="cb9-30"><a href="#cb9-30"></a><span class="co">/* getter and setter */</span></span>
<span id="cb9-31"><a href="#cb9-31"></a>gboolean</span>
<span id="cb9-32"><a href="#cb9-32"></a>t_double_get_value <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> <span class="dt">double</span> <span class="op">*</span>value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-33"><a href="#cb9-33"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>d<span class="op">),</span> FALSE<span class="op">);</span></span>
<span id="cb9-34"><a href="#cb9-34"></a></span>
<span id="cb9-35"><a href="#cb9-35"></a>  <span class="op">*</span>value <span class="op">=</span> d<span class="op">-&gt;</span>value<span class="op">;</span></span>
<span id="cb9-36"><a href="#cb9-36"></a>  <span class="cf">return</span> TRUE<span class="op">;</span></span>
<span id="cb9-37"><a href="#cb9-37"></a><span class="op">}</span></span>
<span id="cb9-38"><a href="#cb9-38"></a></span>
<span id="cb9-39"><a href="#cb9-39"></a><span class="dt">void</span></span>
<span id="cb9-40"><a href="#cb9-40"></a>t_double_set_value <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> <span class="dt">double</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-41"><a href="#cb9-41"></a>  g_return_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>d<span class="op">));</span></span>
<span id="cb9-42"><a href="#cb9-42"></a></span>
<span id="cb9-43"><a href="#cb9-43"></a>  d<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb9-44"><a href="#cb9-44"></a><span class="op">}</span></span>
<span id="cb9-45"><a href="#cb9-45"></a></span>
<span id="cb9-46"><a href="#cb9-46"></a><span class="co">/* arithmetic operator */</span></span>
<span id="cb9-47"><a href="#cb9-47"></a><span class="co">/* These operators create a new instance and return a pointer to it. */</span></span>
<span id="cb9-48"><a href="#cb9-48"></a><span class="pp">#define t_double_binary_op(op) \</span></span>
<span id="cb9-49"><a href="#cb9-49"></a><span class="pp">  if (! t_double_get_value (other, &amp;value)) \</span></span>
<span id="cb9-50"><a href="#cb9-50"></a><span class="pp">    return NULL; \</span></span>
<span id="cb9-51"><a href="#cb9-51"></a><span class="pp">  return t_double_new (self-&gt;value op value);</span></span>
<span id="cb9-52"><a href="#cb9-52"></a></span>
<span id="cb9-53"><a href="#cb9-53"></a>TDouble <span class="op">*</span></span>
<span id="cb9-54"><a href="#cb9-54"></a>t_double_add <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">,</span> TDouble <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-55"><a href="#cb9-55"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-56"><a href="#cb9-56"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-57"><a href="#cb9-57"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb9-58"><a href="#cb9-58"></a></span>
<span id="cb9-59"><a href="#cb9-59"></a>  t_double_binary_op <span class="op">(+)</span></span>
<span id="cb9-60"><a href="#cb9-60"></a><span class="op">}</span></span>
<span id="cb9-61"><a href="#cb9-61"></a></span>
<span id="cb9-62"><a href="#cb9-62"></a>TDouble <span class="op">*</span></span>
<span id="cb9-63"><a href="#cb9-63"></a>t_double_sub <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">,</span> TDouble <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-64"><a href="#cb9-64"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-65"><a href="#cb9-65"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-66"><a href="#cb9-66"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb9-67"><a href="#cb9-67"></a></span>
<span id="cb9-68"><a href="#cb9-68"></a>  t_double_binary_op <span class="op">(-)</span></span>
<span id="cb9-69"><a href="#cb9-69"></a><span class="op">}</span></span>
<span id="cb9-70"><a href="#cb9-70"></a></span>
<span id="cb9-71"><a href="#cb9-71"></a>TDouble <span class="op">*</span></span>
<span id="cb9-72"><a href="#cb9-72"></a>t_double_mul <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">,</span> TDouble <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-73"><a href="#cb9-73"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-74"><a href="#cb9-74"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-75"><a href="#cb9-75"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb9-76"><a href="#cb9-76"></a></span>
<span id="cb9-77"><a href="#cb9-77"></a>  t_double_binary_op <span class="op">(*)</span></span>
<span id="cb9-78"><a href="#cb9-78"></a><span class="op">}</span></span>
<span id="cb9-79"><a href="#cb9-79"></a></span>
<span id="cb9-80"><a href="#cb9-80"></a>TDouble <span class="op">*</span></span>
<span id="cb9-81"><a href="#cb9-81"></a>t_double_div <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">,</span> TDouble <span class="op">*</span>other<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-82"><a href="#cb9-82"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-83"><a href="#cb9-83"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>other<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-84"><a href="#cb9-84"></a>  <span class="dt">double</span> value<span class="op">;</span></span>
<span id="cb9-85"><a href="#cb9-85"></a></span>
<span id="cb9-86"><a href="#cb9-86"></a>  <span class="cf">if</span> <span class="op">((!</span> t_double_get_value <span class="op">(</span>other<span class="op">,</span> <span class="op">&amp;</span>value<span class="op">)))</span></span>
<span id="cb9-87"><a href="#cb9-87"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb9-88"><a href="#cb9-88"></a>  <span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>value <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-89"><a href="#cb9-89"></a>    g_signal_emit <span class="op">(</span>self<span class="op">,</span> t_double_signal<span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb9-90"><a href="#cb9-90"></a>    <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb9-91"><a href="#cb9-91"></a>  <span class="op">}</span></span>
<span id="cb9-92"><a href="#cb9-92"></a>  <span class="cf">return</span> t_double_new <span class="op">(</span>self<span class="op">-&gt;</span>value <span class="op">/</span> value<span class="op">);</span></span>
<span id="cb9-93"><a href="#cb9-93"></a><span class="op">}</span></span>
<span id="cb9-94"><a href="#cb9-94"></a>TDouble <span class="op">*</span></span>
<span id="cb9-95"><a href="#cb9-95"></a>t_double_uminus <span class="op">(</span>TDouble <span class="op">*</span>self<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-96"><a href="#cb9-96"></a>  g_return_val_if_fail <span class="op">(</span>T_IS_DOUBLE <span class="op">(</span>self<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb9-97"><a href="#cb9-97"></a></span>
<span id="cb9-98"><a href="#cb9-98"></a>  <span class="cf">return</span> t_double_new <span class="op">(-</span>self<span class="op">-&gt;</span>value<span class="op">);</span></span>
<span id="cb9-99"><a href="#cb9-99"></a><span class="op">}</span></span>
<span id="cb9-100"><a href="#cb9-100"></a></span>
<span id="cb9-101"><a href="#cb9-101"></a>TDouble <span class="op">*</span></span>
<span id="cb9-102"><a href="#cb9-102"></a>t_double_new <span class="op">(</span><span class="dt">double</span> value<span class="op">)</span> <span class="op">{</span></span>
<span id="cb9-103"><a href="#cb9-103"></a>  TDouble <span class="op">*</span>d<span class="op">;</span></span>
<span id="cb9-104"><a href="#cb9-104"></a></span>
<span id="cb9-105"><a href="#cb9-105"></a>  d <span class="op">=</span> g_object_new <span class="op">(</span>T_TYPE_DOUBLE<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb9-106"><a href="#cb9-106"></a>  d<span class="op">-&gt;</span>value <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb9-107"><a href="#cb9-107"></a>  <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb9-108"><a href="#cb9-108"></a><span class="op">}</span></span></code></pre></div>
<p>main.c</p>
<div class="sourceCode" id="cb10"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;glib-object.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="pp">#include </span><span class="im">&quot;tdouble.h&quot;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>div_by_zero_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error: division by zero.</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7"></a><span class="op">}</span></span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>t_print <span class="op">(</span><span class="dt">char</span> <span class="op">*</span>op<span class="op">,</span> TDouble <span class="op">*</span>d1<span class="op">,</span> TDouble <span class="op">*</span>d2<span class="op">,</span> TDouble <span class="op">*</span>d3<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="dt">double</span> v1<span class="op">,</span> v2<span class="op">,</span> v3<span class="op">;</span></span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a>  <span class="cf">if</span> <span class="op">(!</span> t_double_get_value <span class="op">(</span>d1<span class="op">,</span> <span class="op">&amp;</span>v1<span class="op">))</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb10-15"><a href="#cb10-15"></a>  <span class="cf">if</span> <span class="op">(!</span> t_double_get_value <span class="op">(</span>d2<span class="op">,</span> <span class="op">&amp;</span>v2<span class="op">))</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb10-17"><a href="#cb10-17"></a>  <span class="cf">if</span> <span class="op">(!</span> t_double_get_value <span class="op">(</span>d3<span class="op">,</span> <span class="op">&amp;</span>v3<span class="op">))</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>    <span class="cf">return</span><span class="op">;</span></span>
<span id="cb10-19"><a href="#cb10-19"></a></span>
<span id="cb10-20"><a href="#cb10-20"></a>  g_print <span class="op">(</span><span class="st">&quot;%lf %s %lf = %lf</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> v1<span class="op">,</span> op<span class="op">,</span> v2<span class="op">,</span> v3<span class="op">);</span></span>
<span id="cb10-21"><a href="#cb10-21"></a><span class="op">}</span></span>
<span id="cb10-22"><a href="#cb10-22"></a></span>
<span id="cb10-23"><a href="#cb10-23"></a><span class="dt">int</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-25"><a href="#cb10-25"></a>  TDouble <span class="op">*</span>d1<span class="op">,</span> <span class="op">*</span>d2<span class="op">,</span> <span class="op">*</span>d3<span class="op">;</span></span>
<span id="cb10-26"><a href="#cb10-26"></a>  <span class="dt">double</span> v1<span class="op">,</span> v3<span class="op">;</span></span>
<span id="cb10-27"><a href="#cb10-27"></a></span>
<span id="cb10-28"><a href="#cb10-28"></a>  d1 <span class="op">=</span> t_double_new <span class="op">(</span><span class="fl">10.0</span><span class="op">);</span></span>
<span id="cb10-29"><a href="#cb10-29"></a>  d2 <span class="op">=</span> t_double_new <span class="op">(</span><span class="fl">20.0</span><span class="op">);</span></span>
<span id="cb10-30"><a href="#cb10-30"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_add <span class="op">(</span>d1<span class="op">,</span> d2<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-31"><a href="#cb10-31"></a>    t_print <span class="op">(</span><span class="st">&quot;+&quot;</span><span class="op">,</span> d1<span class="op">,</span> d2<span class="op">,</span> d3<span class="op">);</span></span>
<span id="cb10-32"><a href="#cb10-32"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-33"><a href="#cb10-33"></a>  <span class="op">}</span></span>
<span id="cb10-34"><a href="#cb10-34"></a></span>
<span id="cb10-35"><a href="#cb10-35"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_sub <span class="op">(</span>d1<span class="op">,</span> d2<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>    t_print <span class="op">(</span><span class="st">&quot;-&quot;</span><span class="op">,</span> d1<span class="op">,</span> d2<span class="op">,</span> d3<span class="op">);</span></span>
<span id="cb10-37"><a href="#cb10-37"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-38"><a href="#cb10-38"></a>  <span class="op">}</span></span>
<span id="cb10-39"><a href="#cb10-39"></a></span>
<span id="cb10-40"><a href="#cb10-40"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_mul <span class="op">(</span>d1<span class="op">,</span> d2<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-41"><a href="#cb10-41"></a>    t_print <span class="op">(</span><span class="st">&quot;*&quot;</span><span class="op">,</span> d1<span class="op">,</span> d2<span class="op">,</span> d3<span class="op">);</span></span>
<span id="cb10-42"><a href="#cb10-42"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-43"><a href="#cb10-43"></a>  <span class="op">}</span></span>
<span id="cb10-44"><a href="#cb10-44"></a></span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_div <span class="op">(</span>d1<span class="op">,</span> d2<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-46"><a href="#cb10-46"></a>    t_print <span class="op">(</span><span class="st">&quot;/&quot;</span><span class="op">,</span> d1<span class="op">,</span> d2<span class="op">,</span> d3<span class="op">);</span></span>
<span id="cb10-47"><a href="#cb10-47"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-48"><a href="#cb10-48"></a>  <span class="op">}</span></span>
<span id="cb10-49"><a href="#cb10-49"></a></span>
<span id="cb10-50"><a href="#cb10-50"></a>  g_signal_connect <span class="op">(</span>d1<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>div_by_zero_cb<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb10-51"><a href="#cb10-51"></a>  t_double_set_value <span class="op">(</span>d2<span class="op">,</span> <span class="fl">0.0</span><span class="op">);</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_div <span class="op">(</span>d1<span class="op">,</span> d2<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb10-53"><a href="#cb10-53"></a>    t_print <span class="op">(</span><span class="st">&quot;/&quot;</span><span class="op">,</span> d1<span class="op">,</span> d2<span class="op">,</span> d3<span class="op">);</span></span>
<span id="cb10-54"><a href="#cb10-54"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-55"><a href="#cb10-55"></a>  <span class="op">}</span></span>
<span id="cb10-56"><a href="#cb10-56"></a></span>
<span id="cb10-57"><a href="#cb10-57"></a>  <span class="cf">if</span> <span class="op">((</span>d3 <span class="op">=</span> t_double_uminus <span class="op">(</span>d1<span class="op">))</span> <span class="op">!=</span> NULL <span class="op">&amp;&amp;</span> <span class="op">(</span>t_double_get_value <span class="op">(</span>d1<span class="op">,</span> <span class="op">&amp;</span>v1<span class="op">))</span> <span class="op">&amp;&amp;</span> <span class="op">(</span>t_double_get_value <span class="op">(</span>d3<span class="op">,</span> <span class="op">&amp;</span>v3<span class="op">)))</span> <span class="op">{</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>    g_print <span class="op">(</span><span class="st">&quot;-%lf = %lf</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">,</span> v1<span class="op">,</span> v3<span class="op">);</span></span>
<span id="cb10-59"><a href="#cb10-59"></a>    g_object_unref <span class="op">(</span>d3<span class="op">);</span></span>
<span id="cb10-60"><a href="#cb10-60"></a>  <span class="op">}</span></span>
<span id="cb10-61"><a href="#cb10-61"></a></span>
<span id="cb10-62"><a href="#cb10-62"></a>  g_object_unref <span class="op">(</span>d1<span class="op">);</span></span>
<span id="cb10-63"><a href="#cb10-63"></a>  g_object_unref <span class="op">(</span>d2<span class="op">);</span></span>
<span id="cb10-64"><a href="#cb10-64"></a></span>
<span id="cb10-65"><a href="#cb10-65"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb10-66"><a href="#cb10-66"></a><span class="op">}</span></span></code></pre></div>
<p>To compile, change your current directory to src/tdouble3 and type as
follows.</p>
<pre><code>$ meson _build
$ ninja -C _build</code></pre>
<p>Then, Executable file <code>tdouble</code> is created in
<code>_build</code> directory. Execute it.</p>
<pre><code>$ cd tdouble3; _build/tdouble
10.000000 + 20.000000 = 30.000000
10.000000 - 20.000000 = -10.000000
10.000000 * 20.000000 = 200.000000
10.000000 / 20.000000 = 0.500000

Error: division by zero.

-10.000000 = -10.000000</code></pre>
<h2 id="default-signal-handler">Default signal handler</h2>
<p>You may have thought that it was strange that the error message was
set in <code>main.c</code>. Indeed, the error happens in
<code>tdouble.c</code> so the message should been managed by
<code>tdouble.c</code> itself. GObject system has a default signal
handler that is set in the object itself. A default signal handler is
also called “default handler” or “object method handler”.</p>
<p>You can set a default handler with
<code>g_signal_new_class_handler</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>guint</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>g_signal_new_class_handler <span class="op">(</span><span class="dt">const</span> gchar <span class="op">*</span>signal_name<span class="op">,</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                            GType itype<span class="op">,</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                            GSignalFlags signal_flags<span class="op">,</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                            GCallback class_handler<span class="op">,</span> <span class="co">/*default signal handler */</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                            GSignalAccumulator accumulator<span class="op">,</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                            gpointer accu_data<span class="op">,</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                            GSignalCMarshaller c_marshaller<span class="op">,</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                            GType return_type<span class="op">,</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                            guint n_params<span class="op">,</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                            <span class="op">...);</span></span></code></pre></div>
<p>The difference from <code>g_signal_new</code> is the fourth
parameter. <code>g_signal_new</code> sets a default handler with the
offset of the function pointer in the class structure. If an object is
derivable, it has its own class area, so you can set a default handler
with <code>g_signal_new</code>. But a final type object doesn’t have its
own class area, so it’s impossible to set a default handler with
<code>g_signal_new</code>. That’s the reason why we use
<code>g_signal_new_class_handler</code>.</p>
<p><code>tdouble.c</code> is changed.
<code>div_by_zero_default_cb</code> function is added and
<code>g_signal_new_class_handler</code> replaces
<code>g_signal_new</code>. Default signal handler doesn’t have
<code>user_data</code> parameter. A <code>user_data</code> parameter is
set with <code>g_signal_connect</code> family functions when user
provided signal handler is connected to the signal. Because default
signal handler isn’t connected with <code>g_signal_connect</code> family
function, no user data is given as an argument.</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode numberSource C numberLines"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>div_by_zero_default_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error: division by zero.</span><span class="sc">\n\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="op">}</span></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>t_double_class_init <span class="op">(</span>TDoubleClass <span class="op">*</span>class<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  t_double_signal <span class="op">=</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  g_signal_new_class_handler <span class="op">(</span><span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span></span>
<span id="cb14-10"><a href="#cb14-10"></a>                              G_TYPE_FROM_CLASS <span class="op">(</span>class<span class="op">),</span></span>
<span id="cb14-11"><a href="#cb14-11"></a>                              G_SIGNAL_RUN_LAST <span class="op">|</span> G_SIGNAL_NO_RECURSE <span class="op">|</span> G_SIGNAL_NO_HOOKS<span class="op">,</span></span>
<span id="cb14-12"><a href="#cb14-12"></a>                              G_CALLBACK <span class="op">(</span>div_by_zero_default_cb<span class="op">),</span></span>
<span id="cb14-13"><a href="#cb14-13"></a>                              NULL <span class="co">/* accumulator */</span><span class="op">,</span></span>
<span id="cb14-14"><a href="#cb14-14"></a>                              NULL <span class="co">/* accumulator data */</span><span class="op">,</span></span>
<span id="cb14-15"><a href="#cb14-15"></a>                              NULL <span class="co">/* C marshaller */</span><span class="op">,</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>                              G_TYPE_NONE <span class="co">/* return_type */</span><span class="op">,</span></span>
<span id="cb14-17"><a href="#cb14-17"></a>                              <span class="dv">0</span>     <span class="co">/* n_params */</span></span>
<span id="cb14-18"><a href="#cb14-18"></a>                              <span class="op">);</span></span>
<span id="cb14-19"><a href="#cb14-19"></a><span class="op">}</span></span></code></pre></div>
<p><code>g_signal_connect</code> and <code>div_by_zero_cb</code> are
removed from <code>main.c</code>.</p>
<p>Compile and execute it.</p>
<pre><code>$ cd tdouble4; _build/tdouble
10.000000 + 20.000000 = 30.000000
10.000000 - 20.000000 = -10.000000
10.000000 * 20.000000 = 200.000000
10.000000 / 20.000000 = 0.500000

Error: division by zero.

-10.000000 = -10.000000</code></pre>
<p>The source file is in the directory src/tdouble4.</p>
<p>If you want to connect your handler (user-provided handler) to the
signal, you can still use <code>g_signal_connect</code>. Add the
following in <code>main.c</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>div_by_zero_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error happens in main.c.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="op">...</span> <span class="op">...</span> <span class="op">...</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  g_signal_connect <span class="op">(</span>d1<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>div_by_zero_cb<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="op">...</span> <span class="op">...</span> <span class="op">...</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Then, both the user-provided handler and default handler are called
when the signal is emitted. Compile and execute it, then the following
is shown on your display.</p>
<pre><code>10.000000 + 20.000000 = 30.000000
10.000000 - 20.000000 = -10.000000
10.000000 * 20.000000 = 200.000000
10.000000 / 20.000000 = 0.500000

Error happens in main.c.

Error: division by zero.

-10.000000 = -10.000000</code></pre>
<p>This tells us that the user-provided handler is called first, then
the default handler is called. If you want your handler called after the
default handler, then you can use <code>g_signal_connect_after</code>.
Add the lines below to <code>main.c</code> again.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">void</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>div_by_zero_after_cb <span class="op">(</span>TDouble <span class="op">*</span>d<span class="op">,</span> gpointer user_data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  g_print <span class="op">(</span><span class="st">&quot;</span><span class="sc">\n</span><span class="st">Error has happened in main.c and an error message has been displayed.</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">);</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>main <span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span> <span class="op">{</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="op">...</span> <span class="op">...</span> <span class="op">...</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  g_signal_connect_after <span class="op">(</span>d1<span class="op">,</span> <span class="st">&quot;div-by-zero&quot;</span><span class="op">,</span> G_CALLBACK <span class="op">(</span>div_by_zero_after_cb<span class="op">),</span> NULL<span class="op">);</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="op">...</span> <span class="op">...</span> <span class="op">...</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Compile and execute it, then:</p>
<pre><code>10.000000 + 20.000000 = 30.000000
10.000000 - 20.000000 = -10.000000
10.000000 * 20.000000 = 200.000000
10.000000 / 20.000000 = 0.500000

Error happens in main.c.

Error: division by zero.

Error has happened in main.c and an error message has been displayed.

-10.000000 = -10.000000</code></pre>
<p>The source files are in src/tdouble5.</p>
<h2 id="signal-flag">Signal flag</h2>
<p>The order that handlers are called is described in <a
href="https://docs.gtk.org/gobject/concepts.html#signal-emission">GObject
API Reference, Sigmal emission</a>.</p>
<p>The order depends on the signal flag which is set in
<code>g_signal_new</code> or <code>g_signal_new_class_handler</code>.
There are three flags which relate to the order of handlers’
invocation.</p>
<ul>
<li><code>G_SIGNAL_RUN_FIRST</code>: the default handler is called
before any user provided handler.</li>
<li><code>G_SIGNAL_RUN_LAST</code>: the default handler is called after
the normal user provided handler (not connected with
<code>g_signal_connect_after</code>).</li>
<li><code>G_SIGNAL_RUN_CLEANUP</code>: the default handler is called
after any user provided handler.</li>
</ul>
<p><code>G_SIGNAL_RUN_LAST</code> is the most appropriate in many
cases.</p>
<p>Other signal flags are described in <a
href="https://docs.gtk.org/gobject/flags.SignalFlags.html">GObject API
Rreference</a>.</p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
  </body>
  </html>
